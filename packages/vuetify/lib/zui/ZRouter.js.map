{"version":3,"sources":["../../src/zui/ZRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import VueRouter, { RouteConfig } from 'vue-router'\nimport { RouterOptions } from 'vue-router/types/router'\nimport { CreateAdminRouterOptions, CreateAppRouterOptions, RouteComponent, ZMenuOption } from '../../types'\nimport { ZRouterDescription } from '../../types/zui/ZRouter'\nimport { createRoutesByMenus, genFullPath, genRoutesByOptions } from './util/generatorRouter'\nimport { ZAdmin, ZApp } from '../components'\nimport { ZView403, ZView404, ZView500, ZDefaultLogin } from './components/ZAdmin'\nimport Vue from 'vue'\n\nlet instance: ZRouterClass\n\nexport class ZAppRouter {\n  protected _router: VueRouter | null = null\n  appHome?: RouteComponent\n  appMain?: RouteComponent\n  appLogin?: RouteComponent\n  appNotAccess?: RouteComponent\n  appNotFound?: RouteComponent\n  appServerError?: RouteComponent\n\n  isRenderRouterView = false\n\n  routerOptions?: RouterOptions\n\n  genRoute (path: string, comp: RouteComponent | boolean | undefined, def: RouteComponent): RouteConfig[] {\n    if (comp === true) {\n      return [{ path, component: def }]\n    }\n    if (comp) {\n      return [{ path, component: comp }]\n    }\n    return []\n  }\n\n  getRouter (): VueRouter {\n    if (this._router) {\n      return this._router\n    }\n    this._router = new VueRouter(this.routerOptions)\n    return this._router\n  }\n\n  setting (options: CreateAppRouterOptions) {\n    if (options) {\n      this.isRenderRouterView = !options.appMain && !options.appHome\n\n      this.appHome = options.appHome\n      this.appMain = options.appMain || ZApp\n\n      const routerOptions: RouterOptions = options.routerOptions || Object.create(null)\n      const routes = routerOptions.routes || []\n\n      routes.push(...this.genRoute('/login', options.appLogin, ZDefaultLogin))\n      routes.push(...this.genRoute('/500', options.appServerError, ZView500))\n      routes.push(...this.genRoute('/403', options.appNotAccess, ZView403))\n      routes.push(...this.genRoute('*', options.appNotFound, ZView404))\n\n      routerOptions.routes = routes\n\n      this.routerOptions = routerOptions\n    }\n  }\n}\n\nexport class ZAdminRouter extends ZAppRouter {\n  genComp (usr: RouteComponent | boolean | undefined, def: RouteComponent): RouteComponent | undefined {\n    if (typeof usr === 'boolean') {\n      return usr ? def : undefined\n    }\n    return usr || def\n  }\n\n  get defaultHome () {\n    return Vue.extend({\n      name: 'z-admin-default-home',\n      render (h) {\n        return h('div', { staticClass: 'z-admin-default-home' })\n      },\n    })\n  }\n\n  parseUsrRoutes (routes: RouteConfig[], parentPath: string): RouteConfig[] {\n    const list: RouteConfig[] = []\n    routes.forEach(route => {\n      if (route) {\n        route.path = genFullPath(route.path)\n        route.name = route.name || `usr-${route.path.replace(/\\//g, '-')}`\n        list.push(route)\n      }\n    })\n    return list\n  }\n\n  setting (options: CreateAdminRouterOptions) {\n    const NotFoundElement = this.genComp(options.appNotFound, ZView404)\n    const NotFoundRoute = { path: '*', component: NotFoundElement }\n    const routeLogin: RouteConfig = { name: 'r__login', path: '/login', component: this.genComp(options.appLogin, ZDefaultLogin) }\n    const route500: RouteConfig = { name: 'r__500', path: '/500', component: this.genComp(options.appServerError, ZView500) }\n    const route403: RouteConfig = { name: 'r__403', path: '/403', component: this.genComp(options.appNotAccess, ZView403) }\n    const route404: RouteConfig = { name: 'r__404', path: '/404', component: NotFoundElement }\n\n    const routeRoot404: RouteConfig = { name: 'r__root_404', path: '*', component: NotFoundElement }\n    const routeRoot: RouteConfig = { name: 'r__root', path: '/', component: options.appMain || ZAdmin }\n    let routeHome: RouteConfig = { name: 'r__home', path: '/', component: options.appHome || this.defaultHome }\n\n    let beforeChildren: RouteConfig[] = [routeHome]\n    const middleChildren: RouteConfig[] = []\n    const afterChildren = [NotFoundRoute]\n\n    // 初始化用户自定义重定向路径\n    const routerOptions = options.routerOptions || {}\n    const usrRoutes = routerOptions.routes || []\n    const [usrHome, ...otherHomes] = usrRoutes.filter(i => /^\\/?$/.test(i.path))\n    if (usrHome) {\n      let homeElement = options.appHome || this.defaultHome\n      if ('component' in usrHome && usrHome.component) {\n        homeElement = usrHome.component\n      }\n      routeHome = { name: 'r__home', ...usrHome, path: '/', component: homeElement }\n      beforeChildren = [routeHome, ...otherHomes]\n    }\n\n    const menuRoutes = createRoutesByMenus(options.menus, '')\n\n    middleChildren.push(...this.parseUsrRoutes(usrRoutes, '/'))\n\n    if (options.redirect) {\n      routeHome.redirect = options.redirect\n    }\n\n    routeRoot.children = [...beforeChildren, ...middleChildren, ...menuRoutes, ...afterChildren]\n\n    routerOptions.routes = [\n      routeLogin,\n      route500,\n      route403,\n      route404,\n      routeRoot,\n      routeRoot404,\n    ]\n    this.routerOptions = routerOptions\n  }\n}\n\nexport class ZRouterClass implements ZRouterDescription {\n  get currentRouter (): VueRouter {\n    return ZRouterClass.router\n  }\n\n  get currentRoutePath (): string {\n    return ZRouterClass.router.currentRoute.path\n  }\n\n  getRouter (): VueRouter {\n    return ZRouterClass.router\n  }\n\n  addRoutesByMenus (menus: ZMenuOption[] = []) {\n    const router = this.currentRouter\n    if (router) {\n      const options = ZRouterClass.adminRouter || {}\n      ZRouterClass.menus = menus = menus || []\n\n      const routes: RouteConfig[] = genRoutesByOptions(options)\n      const routerOptions: RouterOptions = options.routerOptions || Object.create(null)\n      routerOptions.routes = routes\n\n      const newRouter = new VueRouter(routerOptions);\n\n      (router as any).matcher = (newRouter as any).matcher\n\n      // 强制刷新当前路由\n      const route = router.currentRoute\n      router.replace({ path: route.path, query: { ...route.query, t: Date.now() + '' } }).then()\n      router.replace({ path: route.path, query: { ...route.query } }).then()\n    }\n  }\n\n  constructor () {\n    if (!instance) {\n      instance = this\n    }\n    return instance\n  }\n\n  static appRouter: ZAppRouter;\n  static adminRouter: ZAdminRouter;\n  static genAppRouter (options: CreateAppRouterOptions): ZAppRouter {\n    const appRouter = new ZAppRouter()\n    appRouter.setting(options)\n    ZRouterClass.appRouter = appRouter\n    return appRouter\n  }\n\n  static genAdminRouter (options: CreateAdminRouterOptions): ZAdminRouter {\n    const adminRouter = new ZAdminRouter()\n    adminRouter.setting(options)\n    ZRouterClass.adminRouter = adminRouter\n    return adminRouter\n  }\n\n  static menus?: ZMenuOption[]\n\n  static router: VueRouter\n\n  static genInstance (): ZRouterClass {\n    if (!instance) {\n      instance = new ZRouterClass()\n    }\n    return instance\n  }\n}\n\nexport const ZRouter = ZRouterClass.genInstance()\n"],"sourceRoot":"","file":"ZRouter.js"}