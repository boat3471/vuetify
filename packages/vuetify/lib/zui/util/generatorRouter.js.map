{"version":3,"sources":["../../../src/zui/util/generatorRouter.ts"],"names":[],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport { RouteConfig } from 'vue-router'\nimport { RedirectOption } from 'vue-router/types/router'\nimport { ZView403, ZView404, ZView500, ZDefaultLogin } from '../components/ZAdmin'\nimport {\n  CreateAdminRouterOptions,\n  RouteComponent,\n  ZMenuOption,\n} from '../../../types'\nimport debug from './debug'\n\nconst defaultHome = Vue.extend({\n  name: 'z-admin-default-home',\n  render (h) {\n    return h('div', { staticClass: 'z-admin-default-home' })\n  },\n})\n\n/** 生成异常路由 */\nexport function genExceptionRoute (name = '', path = ''): RouteConfig[] {\n  const list: RouteConfig[] = []\n  list.push({\n    name: `${name}-403`,\n    path: `${path}/403`.replace(/\\/\\//g, '/'),\n    component: ZView403,\n  })\n  list.push({\n    name: `${name}-500`,\n    path: `${path}/500`.replace(/\\/\\//g, '/'),\n    component: ZView500,\n  })\n  list.push({\n    name: `${name}-404`,\n    path: `${path}/*`.replace(/\\/\\//g, '/'),\n    component: ZView404,\n  })\n  return list\n}\n\n/** 添加404 */\nfunction addNotFoundRoute (route: RouteConfig, notFoundComponent: RouteComponent): void {\n  if (route.children && route.children.length > 0) {\n    // 如果已经存在，则不添加\n    const needed = !(route.children.some(i => i.path === '*') || route.path === '/' || route.path === '*')\n    if (needed) {\n      route.children.push({ path: '*', component: notFoundComponent })\n    }\n    route.children.forEach(child => addNotFoundRoute(child, notFoundComponent))\n  }\n}\n\ndebug.ignore(addNotFoundRoute)\n\nfunction parseUsrRoutes (routes: RouteConfig[], parentPath: string): RouteConfig[] {\n  const list: RouteConfig[] = []\n  routes.forEach(route => {\n    if (route) {\n      route.path = genFullPath(route.path)\n      route.name = route.name || `usr-${route.path.replace(/\\//g, '-')}`\n      list.push(route)\n    }\n  })\n  return list\n}\n\nfunction genComp (usr: RouteComponent | boolean | undefined, def: RouteComponent): RouteComponent | undefined {\n  if (typeof usr === 'boolean') {\n    return usr ? def : undefined\n  }\n  return usr || def\n}\n\n/**\n * 根据选项生成路由列表\n */\nexport function genRoutesByOptions (options: CreateAdminRouterOptions): RouteConfig[] {\n  const NotFoundElement = genComp(options.appNotFound, ZView404)\n  const NotFoundRoute = { path: '*', component: NotFoundElement }\n  const routeLogin: RouteConfig = { name: 'r__login', path: '/login', component: genComp(options.appLogin, ZDefaultLogin) }\n  const route500: RouteConfig = { name: 'r__500', path: '/500', component: genComp(options.appServerError, ZView500) }\n  const route403: RouteConfig = { name: 'r__403', path: '/403', component: genComp(options.appNotAccess, ZView403) }\n  const route404: RouteConfig = { name: 'r__404', path: '/404', component: NotFoundElement }\n\n  const routeRoot404: RouteConfig = { name: 'r__root_404', path: '*', component: NotFoundElement }\n  const routeRoot: RouteConfig = { name: 'r__root', path: '/', component: options.appMain }\n  let routeHome: RouteConfig = { name: 'r__home', path: '/', component: options.appHome || defaultHome }\n\n  let beforeChildren: RouteConfig[] = [routeHome]\n  const middleChildren: RouteConfig[] = []\n  const afterChildren = [NotFoundRoute]\n\n  // 初始化用户自定义重定向路径\n  const routerOptions = options.routerOptions || {}\n  const usrRoutes = routerOptions.routes || []\n  const [usrHome, ...otherHomes] = usrRoutes.filter(i => /^\\/?$/.test(i.path))\n  if (usrHome) {\n    let homeElement = options.appHome || defaultHome\n    if ('component' in usrHome && usrHome.component) {\n      homeElement = usrHome.component\n    }\n    routeHome = { name: 'r__home', ...usrHome, path: '/', component: homeElement }\n    beforeChildren = [routeHome, ...otherHomes]\n  }\n\n  // console.info('usrRoutes', usrRedirect, usrRoutes)\n\n  // const redirect = usrRedirect || ''\n  // routeRoot.children = createRoutesByMenus(menus, redirect)\n\n  // addNotFoundRoute(routeRoot, Comp404)\n  middleChildren.push(...parseUsrRoutes(usrRoutes, '/'))\n\n  routeRoot.children = [...beforeChildren, ...middleChildren, ...afterChildren]\n\n  return [\n    routeLogin,\n    route500,\n    route403,\n    route404,\n    routeRoot,\n    routeRoot404,\n  ]\n}\n\n/**\n * 根据菜单生成路由列表\n * @param menus\n * @param rootList\n * @param parentPath\n */\nexport function genRoutesByMenus (menus: ZMenuOption[], rootList: RouteConfig[], parentPath = '/'): RouteConfig[] {\n  const list: RouteConfig[] = []\n  if (menus) {\n    menus.forEach(menu => {\n      if (!menu.path && !menu.href && (!menu.children || menu.children.length < 1)) {\n        window.console.warn(`菜单配置无法生成路由: \\n ${JSON.stringify(menu, null, 4)}`)\n        return\n      }\n      menu.path = menu.path || ''\n      let path = (menu.path || '').indexOf('/') === 0 ? menu.path : `${parentPath}/${menu.path}`\n      path = path.replace(/\\/{2,}/g, '/')\n      if (menu.path) {\n        const route: RouteConfig = {\n          name: menu.name,\n          path: path || '',\n          component: menu.component,\n          meta: {\n            name: menu.name || menu.title,\n            ...menu.meta,\n          },\n        }\n\n        if (menu.redirect) {\n          route.redirect = menu.redirect\n        }\n\n        if (menu.alias) {\n          route.alias = menu.alias\n        }\n\n        if (menu.beforeEnter) {\n          route.beforeEnter = menu.beforeEnter\n        }\n\n        route.name = (route.path || '').replace(/\\//g, '-')\n\n        rootList.push(route)\n      }\n\n      if (menu.children && menu.children.length > 0) {\n        genRoutesByMenus(menu.children, rootList, path)\n      }\n    })\n  }\n  return list\n}\n\n/**\n * 根据菜单创建路由列表\n * @param menus\n * @param redirect\n */\nexport function createRoutesByMenus (menus: ZMenuOption[] = [], redirect: RedirectOption = '/home'): RouteConfig[] {\n  if (menus && menus.length > 0) {\n    const children: RouteConfig[] = []\n    children.push(...genRoutesByMenus(menus, children, '/'))\n    children.push(...genExceptionRoute())\n    // children.push({ name: '--empty', path: '', redirect })\n    return children\n  }\n  return []\n}\n\n/**\n * 生成完整路径\n * @param path\n * @param parentPath\n */\nexport function genFullPath (path: string, parentPath?: string): string {\n  if (path.indexOf('/') !== 0) {\n    return `/${parentPath || ''}/${path}`.replace(/\\/+/g, '/')\n  }\n  return path\n}\n"],"sourceRoot":"","file":"generatorRouter.js"}