{"version":3,"sources":["../../src/zui/ZMenu.ts"],"names":[],"mappings":"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","sourcesContent":["import Vue from 'vue'\nimport { ZMenuOption } from '../../types'\nimport { ZMenuDescription } from '../../types/zui/ZMenu'\nimport { ZRouterClass } from './ZRouter'\n\nfunction filterMenusData (list: ZMenuOption[], level = 0, parent: ZMenuOption | null = null): ZMenuOption[] {\n  if (list && list.length > 0) {\n    const menus: ZMenuOption[] = []\n    list.forEach(item => {\n      item.level = level\n      if (item.visible === false) {\n        return\n      }\n      const parents = parent ? [...parent.parents, parent] : []\n      const parentPaths: string[] = parent ? [...(parent.parentPaths || []), (parent.path || '')] : []\n      const info: ZMenuOption = {\n        path: item.path,\n        name: item.name,\n        children: item.children,\n        redirect: item.redirect,\n        alias: item.alias,\n        meta: item.meta,\n        title: item.title || item.name,\n        icon: item.icon,\n        roles: item.roles,\n        href: item.href,\n        target: item.target,\n        visible: item.visible,\n        query: item.query,\n        level: item.level,\n        active: false,\n        key: (item.path || '').replace(/\\//g, '-'),\n        parent,\n        parents,\n        parentPaths,\n      }\n\n      if (info.path && info.path.indexOf('/') !== 0) {\n        const parentPath = parent ? parent.path : ''\n        info.path = `${parentPath}/${info.path}`\n        info.path = info.path.replace(/\\/{2,}/g, '/')\n      }\n      // const parentPaths = [...info.parentPaths, (info.path || '')]\n      info.children = filterMenusData(item.children || [], level + 1, info)\n      delete info.component\n      menus.push(info)\n    })\n    return menus\n  }\n  return []\n}\n\n/**\n * 根据指定路径获取所有需要展开和选中的菜单\n * @param menus 菜单列表\n * @param path 指定的路径\n */\nfunction findMenuByUrl (menus: ZMenuOption[], path = ''): ZMenuOption | null {\n  if (!path) {\n    return null\n  }\n  let menu: ZMenuOption | null = null\n  for (const item of menus) {\n    if (item.path === path) {\n      menu = item\n      break\n    }\n\n    if (item.children && item.children.length > 0) {\n      const child = findMenuByUrl(item.children, path)\n      child && (menu = child)\n    }\n  }\n  return menu\n}\n\n/**\n * 重置所有选中的菜单，不包含可展开节点\n * @param menus\n */\nfunction resetSelectedStatus (menus: ZMenuOption[]) {\n  menus.forEach(m => {\n    if (m.children && m.children.length > 0) {\n      resetSelectedStatus(m.children)\n    } else {\n      m.active && (m.active = false)\n    }\n  })\n}\n\nconst __events = new Vue()\nlet instance: ZMenuClass\n\nexport class ZMenuClass implements ZMenuDescription {\n  selectedMenu: ZMenuOption | null = null\n  isRender = false;\n\n  get menusData (): ZMenuOption[] {\n    return ZMenuClass.__menusData\n  }\n\n  get $router (): ZRouterClass {\n    return ZRouterClass.genInstance()\n  }\n\n  settingMenus (menus: ZMenuOption[], autoGenRoute = true): void {\n    this.isRender = (menus ? menus.length > 0 : false)\n    if (menus && menus.length > 0) {\n      if (autoGenRoute) {\n        this.$router.addRoutesByMenus(menus)\n      }\n      const menusData = filterMenusData(menus)\n      ZMenuClass.__menusData = menusData\n      __events.$emit('update-menus', menusData)\n    }\n  }\n\n  resetStatus (menus?: ZMenuOption[]) {\n    const list = menus || this.menusData || []\n    list.forEach(item => {\n      item.active = false\n      if (item.children && item.children.length > 0) {\n        this.resetStatus(item.children)\n      }\n    })\n  }\n\n  resetSelectedStatus (): void {\n    resetSelectedStatus(this.menusData || [])\n  }\n\n  activeByRoute (route?: string | ZMenuOption): void {\n    route = route || this.$router.currentRoutePath\n\n    let menu = null\n    if (typeof route === 'string') {\n      menu = findMenuByUrl(this.menusData, route || this.$router.currentRoutePath)\n    } else {\n      menu = route\n    }\n    if (menu) {\n      menu.active = true\n      if (menu.parents) {\n        menu.parents.forEach(p => {\n          p.active = true\n        })\n      }\n      this.selectedMenu = menu\n    }\n  }\n\n  closeSiblingMenus (menu: ZMenuOption): void {\n    const siblings = menu.parent ? (menu.parent.children || []) : this.menusData\n    siblings.forEach(m => {\n      if (m.path !== menu.path && m.children && m.children.length > 0) {\n        m.active = false\n      }\n    })\n  }\n\n  /**\n   * 子级是否有选中的菜单\n   * @param menu\n   */\n  checkActivatedChildren (menu: ZMenuOption): boolean {\n    if (!menu.children || menu.children.length === 0) {\n      return menu.active || false\n    }\n    let active = false\n    menu.children.forEach(m => {\n      if (!m.children || m.children.length === 0) {\n        active = m.active || false\n      } else {\n        active = this.checkActivatedChildren(m)\n      }\n    })\n    return active\n  }\n\n  onUpdateMenus (callback: (menus: ZMenuOption[]) => void) {\n    __events.$on('update-menus', callback)\n  }\n\n  offUpdateMenus (callback?: Function) {\n    __events.$off('update-menus', callback)\n  }\n\n  constructor () {\n    if (!instance) {\n      instance = this\n    }\n    return instance\n  }\n\n  static __menusData: ZMenuOption[] = [];\n\n  static genInstance (): ZMenuClass {\n    if (!instance) {\n      instance = new ZMenuClass()\n    }\n    return instance\n  }\n}\n\nexport const ZMenu = ZMenuClass.genInstance()\n"],"sourceRoot":"","file":"ZMenu.js"}