{"version":3,"sources":["../../../../src/zui/directives/drag-move/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { DirectiveOptions } from 'vue'\n\n/**\n * 使用说明\n * 1. 引入指令\n *      import dragMoveDirective from drag-move.directive.js\n * 2. 注册指令\n *      directive:{ dragMove: dragMoveDirective }\n * 3. 使用指令\n *      a. <component v-drag-move /> 整个容器都可触发拖动\n *      b. <component v-drag-move:activitor=\"['#id1','#id2','.className']\" 只有容器内#id1，#id2，.className 的元素可触发拖动\n */\n\nfunction getActivitorEls (el: HTMLElement, binding: any) {\n  if (binding.arg !== 'activitor') return [el]\n  const bindingValue = binding.value && Array.isArray(binding.value) ? binding.value : []\n  let activitorEls: HTMLElement[] = []\n  for (let i = 0, len = bindingValue.length; i < len; i++) {\n    const selector = bindingValue[i]\n    const activeEls = el.querySelectorAll(selector)\n    activeEls.length && (activitorEls = [...activitorEls, ...activeEls])\n  }\n  return activitorEls.length ? activitorEls : [el]\n}\n\nexport const DragMove: DirectiveOptions = {\n  inserted (el: HTMLElement, binding: any) {\n    const dialogEl = el\n    if (!dialogEl) return\n    let isInited = false\n    const activitorEls = getActivitorEls(el, binding)\n    let dialogHeight = 0\n    let dialogWidth = 0\n    let dialogTop = 0\n    let dialogLeft = 0\n    let movedDialogTop = 0\n    let movedDialogLeft = 0\n\n    activitorEls.forEach(activitorEl => {\n      // 第一次被拖动时初始化数据\n      activitorEl.addEventListener('mousedown', init)\n      activitorEl.addEventListener('mousedown', addMousemoveEvent)\n    })\n\n    // 初始化\n    function init () {\n      if (isInited) {\n        activitorEls.forEach(activitorEl => {\n          activitorEl.removeEventListener('mousedown', init)\n        })\n        return\n      }\n      const boundingClientRect = dialogEl.getBoundingClientRect()\n      dialogHeight = dialogEl.offsetHeight\n      dialogWidth = dialogEl.offsetWidth\n      dialogTop = boundingClientRect.top\n      dialogLeft = boundingClientRect.left\n      movedDialogTop = dialogTop\n      movedDialogLeft = dialogLeft\n      dialogEl.style.cssText += `position:fixed; top: ${dialogTop}px; left: ${dialogLeft}px; width:${dialogWidth}px; height:${dialogHeight}px;`\n      isInited = true\n    }\n\n    // 添加鼠标事件\n    function addMousemoveEvent (e: MouseEvent) {\n      e.preventDefault()\n      document.body.addEventListener('mousemove', handleMouseMove)\n      document.body.addEventListener('mouseup', removeMousemoveEvent)\n      document.body.addEventListener('mouseleave', removeMousemoveEvent)\n    }\n\n    // 移除鼠标事件\n    function removeMousemoveEvent () {\n      document.body.removeEventListener('mousemove', handleMouseMove)\n      document.body.removeEventListener('mouseleave', removeMousemoveEvent)\n      document.body.removeEventListener('mouseup', removeMousemoveEvent)\n    }\n\n    // 操作鼠标移动\n    function handleMouseMove (e: MouseEvent) {\n      const { movementX, movementY } = e\n      const outerWindowX = 200\n      const outerWindowY = 200\n      movedDialogTop = movedDialogTop + movementY\n      movedDialogLeft = movedDialogLeft + movementX\n      movedDialogTop = movedDialogTop <= -outerWindowY ? -outerWindowY : movedDialogTop\n      movedDialogTop = movedDialogTop >= window.innerHeight - dialogHeight + outerWindowY\n        ? window.innerHeight - dialogHeight + outerWindowY\n        : movedDialogTop\n      movedDialogLeft = movedDialogLeft <= -outerWindowX ? -outerWindowX : movedDialogLeft\n      movedDialogLeft = movedDialogLeft >= window.innerWidth - dialogWidth + outerWindowX\n        ? window.innerWidth - dialogWidth + outerWindowX\n        : movedDialogLeft\n      dialogEl.style.top = movedDialogTop + 'px'\n      dialogEl.style.left = movedDialogLeft + 'px'\n    }\n  },\n}\n\nexport default DragMove\n"],"sourceRoot":"","file":"index.js"}