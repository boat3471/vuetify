{"version":3,"sources":["../../src/zui/ZRouter.ts"],"names":[],"mappings":";;;;;;;AAAA;;AAIA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAI,QAAJ;;IAEa,U;;;AAAb,wBAAA;AAAA;;AACY,SAAA,OAAA,GAA4B,IAA5B;AAQV,SAAA,kBAAA,GAAqB,KAArB;AA0CD;;;;6BAtCW,I,EAAc,I,EAA4C,G,EAAmB;AACrF,UAAI,IAAI,KAAK,IAAb,EAAmB;AACjB,eAAO,CAAC;AAAE,UAAA,IAAI,EAAJ,IAAF;AAAQ,UAAA,SAAS,EAAE;AAAnB,SAAD,CAAP;AACD;;AACD,UAAI,IAAJ,EAAU;AACR,eAAO,CAAC;AAAE,UAAA,IAAI,EAAJ,IAAF;AAAQ,UAAA,SAAS,EAAE;AAAnB,SAAD,CAAP;AACD;;AACD,aAAO,EAAP;AACD;;;gCAEQ;AACP,UAAI,KAAK,OAAT,EAAkB;AAChB,eAAO,KAAK,OAAZ;AACD;;AACD,WAAK,OAAL,GAAe,IAAI,kBAAJ,CAAc,KAAK,aAAnB,CAAf;AACA,aAAO,KAAK,OAAZ;AACD;;;4BAEQ,O,EAA+B;AACtC,UAAI,OAAJ,EAAa;AACX,aAAK,kBAAL,GAA0B,CAAC,OAAO,CAAC,OAAT,IAAoB,CAAC,OAAO,CAAC,OAAvD;AAEA,aAAK,OAAL,GAAe,OAAO,CAAC,OAAvB;AACA,aAAK,OAAL,GAAe,OAAO,CAAC,OAAR,IAAmB,gBAAlC;AAEA,YAAM,aAAa,GAAkB,OAAO,CAAC,aAAR,IAAyB,MAAM,CAAC,MAAP,CAAc,IAAd,CAA9D;AACA,YAAM,MAAM,GAAG,aAAa,CAAC,MAAd,IAAwB,EAAvC;AAEA,QAAA,MAAM,CAAC,IAAP,OAAA,MAAM,qBAAS,KAAK,QAAL,CAAc,QAAd,EAAwB,OAAO,CAAC,QAAhC,EAA0C,qBAA1C,CAAT,EAAN;AACA,QAAA,MAAM,CAAC,IAAP,OAAA,MAAM,qBAAS,KAAK,QAAL,CAAc,MAAd,EAAsB,OAAO,CAAC,cAA9B,EAA8C,gBAA9C,CAAT,EAAN;AACA,QAAA,MAAM,CAAC,IAAP,OAAA,MAAM,qBAAS,KAAK,QAAL,CAAc,MAAd,EAAsB,OAAO,CAAC,YAA9B,EAA4C,gBAA5C,CAAT,EAAN;AACA,QAAA,MAAM,CAAC,IAAP,OAAA,MAAM,qBAAS,KAAK,QAAL,CAAc,GAAd,EAAmB,OAAO,CAAC,WAA3B,EAAwC,gBAAxC,CAAT,EAAN;AAEA,QAAA,aAAa,CAAC,MAAd,GAAuB,MAAvB;AAEA,aAAK,aAAL,GAAqB,aAArB;AACD;AACF;;;;;;;;IAGU,Y;;;;;;;;;;;;;4BACF,G,EAA2C,G,EAAmB;AACrE,UAAI,OAAO,GAAP,KAAe,SAAnB,EAA8B;AAC5B,eAAO,GAAG,GAAG,GAAH,GAAS,SAAnB;AACD;;AACD,aAAO,GAAG,IAAI,GAAd;AACD;;;mCAWe,M,EAAuB,U,EAAkB;AACvD,UAAM,IAAI,GAAkB,EAA5B;AACA,MAAA,MAAM,CAAC,OAAP,CAAe,UAAA,KAAK,EAAG;AACrB,YAAI,KAAJ,EAAW;AACT,UAAA,KAAK,CAAC,IAAN,GAAa,kCAAY,KAAK,CAAC,IAAlB,CAAb;AACA,UAAA,KAAK,CAAC,IAAN,GAAa,KAAK,CAAC,IAAN,kBAAqB,KAAK,CAAC,IAAN,CAAW,OAAX,CAAmB,KAAnB,EAA0B,GAA1B,CAArB,CAAb;AACA,UAAA,IAAI,CAAC,IAAL,CAAU,KAAV;AACD;AACF,OAND;AAOA,aAAO,IAAP;AACD;;;4BAEQ,O,EAAiC;AACxC,UAAM,eAAe,GAAG,KAAK,OAAL,CAAa,OAAO,CAAC,WAArB,EAAkC,gBAAlC,CAAxB;AACA,UAAM,aAAa,GAAG;AAAE,QAAA,IAAI,EAAE,GAAR;AAAa,QAAA,SAAS,EAAE;AAAxB,OAAtB;AACA,UAAM,UAAU,GAAgB;AAAE,QAAA,IAAI,EAAE,UAAR;AAAoB,QAAA,IAAI,EAAE,QAA1B;AAAoC,QAAA,SAAS,EAAE,KAAK,OAAL,CAAa,OAAO,CAAC,QAArB,EAA+B,qBAA/B;AAA/C,OAAhC;AACA,UAAM,QAAQ,GAAgB;AAAE,QAAA,IAAI,EAAE,QAAR;AAAkB,QAAA,IAAI,EAAE,MAAxB;AAAgC,QAAA,SAAS,EAAE,KAAK,OAAL,CAAa,OAAO,CAAC,cAArB,EAAqC,gBAArC;AAA3C,OAA9B;AACA,UAAM,QAAQ,GAAgB;AAAE,QAAA,IAAI,EAAE,QAAR;AAAkB,QAAA,IAAI,EAAE,MAAxB;AAAgC,QAAA,SAAS,EAAE,KAAK,OAAL,CAAa,OAAO,CAAC,YAArB,EAAmC,gBAAnC;AAA3C,OAA9B;AACA,UAAM,QAAQ,GAAgB;AAAE,QAAA,IAAI,EAAE,QAAR;AAAkB,QAAA,IAAI,EAAE,MAAxB;AAAgC,QAAA,SAAS,EAAE;AAA3C,OAA9B;AAEA,UAAM,YAAY,GAAgB;AAAE,QAAA,IAAI,EAAE,aAAR;AAAuB,QAAA,IAAI,EAAE,GAA7B;AAAkC,QAAA,SAAS,EAAE;AAA7C,OAAlC;AACA,UAAM,SAAS,GAAgB;AAAE,QAAA,IAAI,EAAE,SAAR;AAAmB,QAAA,IAAI,EAAE,GAAzB;AAA8B,QAAA,SAAS,EAAE,OAAO,CAAC,OAAR,IAAmB;AAA5D,OAA/B;AACA,UAAI,SAAS,GAAgB;AAAE,QAAA,IAAI,EAAE,SAAR;AAAmB,QAAA,IAAI,EAAE,GAAzB;AAA8B,QAAA,SAAS,EAAE,OAAO,CAAC,OAAR,IAAmB,KAAK;AAAjE,OAA7B;AAEA,UAAI,cAAc,GAAkB,CAAC,SAAD,CAApC;AACA,UAAM,cAAc,GAAkB,EAAtC;AACA,UAAM,aAAa,GAAG,CAAC,aAAD,CAAtB,CAdwC,CAgBxC;;AACA,UAAM,aAAa,GAAG,OAAO,CAAC,aAAR,IAAyB,EAA/C;AACA,UAAM,SAAS,GAAG,aAAa,CAAC,MAAd,IAAwB,EAA1C;;AAlBwC,8BAmBP,SAAS,CAAC,MAAV,CAAiB,UAAA,CAAC;AAAA,eAAI,QAAQ,IAAR,CAAa,CAAC,CAAC,IAAf,CAAJ;AAAA,OAAlB,CAnBO;AAAA;AAAA,UAmBjC,OAnBiC;AAAA,UAmBrB,UAnBqB;;AAoBxC,UAAI,OAAJ,EAAa;AACX,YAAI,WAAW,GAAG,OAAO,CAAC,OAAR,IAAmB,KAAK,WAA1C;;AACA,YAAI,eAAe,OAAf,IAA0B,OAAO,CAAC,SAAtC,EAAiD;AAC/C,UAAA,WAAW,GAAG,OAAO,CAAC,SAAtB;AACD;;AACD,QAAA,SAAS;AAAK,UAAA,IAAI,EAAE;AAAX,WAAyB,OAAzB;AAAkC,UAAA,IAAI,EAAE,GAAxC;AAA6C,UAAA,SAAS,EAAE;AAAxD,UAAT;AACA,QAAA,cAAc,IAAI,SAAJ,4BAAkB,UAAlB,EAAd;AACD;;AAED,UAAM,UAAU,GAAG,0CAAoB,OAAO,CAAC,KAA5B,EAAmC,EAAnC,CAAnB;AAEA,MAAA,cAAc,CAAC,IAAf,OAAA,cAAc,qBAAS,KAAK,cAAL,CAAoB,SAApB,EAA+B,GAA/B,CAAT,EAAd;;AAEA,UAAI,OAAO,CAAC,QAAZ,EAAsB;AACpB,QAAA,SAAS,CAAC,QAAV,GAAqB,OAAO,CAAC,QAA7B;AACD;;AAED,MAAA,SAAS,CAAC,QAAV,gCAAyB,cAAzB,GAA4C,cAA5C,qBAA+D,UAA/D,GAA8E,aAA9E;AAEA,MAAA,aAAa,CAAC,MAAd,GAAuB,CACrB,UADqB,EAErB,QAFqB,EAGrB,QAHqB,EAIrB,QAJqB,EAKrB,SALqB,EAMrB,YANqB,CAAvB;AAQA,WAAK,aAAL,GAAqB,aAArB;AACD;;;wBArEc;AACb,aAAO,aAAI,MAAJ,CAAW;AAChB,QAAA,IAAI,EAAE,sBADU;AAEhB,QAAA,MAFgB,kBAER,CAFQ,EAEP;AACP,iBAAO,CAAC,CAAC,KAAD,EAAQ;AAAE,YAAA,WAAW,EAAE;AAAf,WAAR,CAAR;AACD;AAJe,OAAX,CAAP;AAMD;;;;EAf+B,U;;;;IAgFrB,Y;;;AAkCX,0BAAA;AAAA;;AACE,QAAI,CAAC,QAAL,EAAe;AACb,MAAA,QAAQ,GAAG,IAAX;AACD;;AACD,WAAO,QAAP;AACD;;;;gCA9BQ;AACP,aAAO,YAAY,CAAC,MAApB;AACD;;;uCAE0C;AAAA,UAAzB,KAAyB,uEAAF,EAAE;AACzC,UAAM,MAAM,GAAG,KAAK,aAApB;;AACA,UAAI,MAAJ,EAAY;AACV,YAAM,OAAO,GAAG,YAAY,CAAC,WAAb,IAA4B,EAA5C;AACA,QAAA,YAAY,CAAC,KAAb,GAAqB,KAAK,GAAG,KAAK,IAAI,EAAtC;AAEA,YAAM,MAAM,GAAkB,yCAAmB,OAAnB,CAA9B;AACA,YAAM,aAAa,GAAkB,OAAO,CAAC,aAAR,IAAyB,MAAM,CAAC,MAAP,CAAc,IAAd,CAA9D;AACA,QAAA,aAAa,CAAC,MAAd,GAAuB,MAAvB;AAEA,YAAM,SAAS,GAAG,IAAI,kBAAJ,CAAc,aAAd,CAAlB;AAEC,QAAA,MAAc,CAAC,OAAf,GAA0B,SAAiB,CAAC,OAA5C,CAVS,CAYV;;AACA,YAAM,KAAK,GAAG,MAAM,CAAC,YAArB;AACA,QAAA,MAAM,CAAC,OAAP,CAAe;AAAE,UAAA,IAAI,EAAE,KAAK,CAAC,IAAd;AAAoB,UAAA,KAAK,oBAAO,KAAK,CAAC,KAAb;AAAoB,YAAA,CAAC,EAAE,IAAI,CAAC,GAAL,KAAa;AAApC;AAAzB,SAAf,EAAoF,IAApF;AACA,QAAA,MAAM,CAAC,OAAP,CAAe;AAAE,UAAA,IAAI,EAAE,KAAK,CAAC,IAAd;AAAoB,UAAA,KAAK,oBAAO,KAAK,CAAC,KAAb;AAAzB,SAAf,EAAgE,IAAhE;AACD;AACF;;;wBA/BgB;AACf,aAAO,YAAY,CAAC,MAApB;AACD;;;wBAEmB;AAClB,aAAO,YAAY,CAAC,MAAb,CAAoB,YAApB,CAAiC,IAAxC;AACD;;;iCAoCoB,O,EAA+B;AAClD,UAAM,SAAS,GAAG,IAAI,UAAJ,EAAlB;AACA,MAAA,SAAS,CAAC,OAAV,CAAkB,OAAlB;AACA,MAAA,YAAY,CAAC,SAAb,GAAyB,SAAzB;AACA,aAAO,SAAP;AACD;;;mCAEsB,O,EAAiC;AACtD,UAAM,WAAW,GAAG,IAAI,YAAJ,EAApB;AACA,MAAA,WAAW,CAAC,OAAZ,CAAoB,OAApB;AACA,MAAA,YAAY,CAAC,WAAb,GAA2B,WAA3B;AACA,aAAO,WAAP;AACD;;;kCAMiB;AAChB,UAAI,CAAC,QAAL,EAAe;AACb,QAAA,QAAQ,GAAG,IAAI,YAAJ,EAAX;AACD;;AACD,aAAO,QAAP;AACD;;;;;;;AAGI,IAAM,OAAO,GAAG,YAAY,CAAC,WAAb,EAAhB","sourcesContent":["import VueRouter, { RouteConfig } from 'vue-router'\nimport { RouterOptions } from 'vue-router/types/router'\nimport { CreateAdminRouterOptions, CreateAppRouterOptions, RouteComponent, ZMenuOption } from '../../types'\nimport { ZRouterDescription } from '../../types/zui/ZRouter'\nimport { createRoutesByMenus, genFullPath, genRoutesByOptions } from './util/generatorRouter'\nimport { ZAdmin, ZApp } from '../components'\nimport { ZView403, ZView404, ZView500, ZDefaultLogin } from './components/ZAdmin'\nimport Vue from 'vue'\n\nlet instance: ZRouterClass\n\nexport class ZAppRouter {\n  protected _router: VueRouter | null = null\n  appHome?: RouteComponent\n  appMain?: RouteComponent\n  appLogin?: RouteComponent\n  appNotAccess?: RouteComponent\n  appNotFound?: RouteComponent\n  appServerError?: RouteComponent\n\n  isRenderRouterView = false\n\n  routerOptions?: RouterOptions\n\n  genRoute (path: string, comp: RouteComponent | boolean | undefined, def: RouteComponent): RouteConfig[] {\n    if (comp === true) {\n      return [{ path, component: def }]\n    }\n    if (comp) {\n      return [{ path, component: comp }]\n    }\n    return []\n  }\n\n  getRouter (): VueRouter {\n    if (this._router) {\n      return this._router\n    }\n    this._router = new VueRouter(this.routerOptions)\n    return this._router\n  }\n\n  setting (options: CreateAppRouterOptions) {\n    if (options) {\n      this.isRenderRouterView = !options.appMain && !options.appHome\n\n      this.appHome = options.appHome\n      this.appMain = options.appMain || ZApp\n\n      const routerOptions: RouterOptions = options.routerOptions || Object.create(null)\n      const routes = routerOptions.routes || []\n\n      routes.push(...this.genRoute('/login', options.appLogin, ZDefaultLogin))\n      routes.push(...this.genRoute('/500', options.appServerError, ZView500))\n      routes.push(...this.genRoute('/403', options.appNotAccess, ZView403))\n      routes.push(...this.genRoute('*', options.appNotFound, ZView404))\n\n      routerOptions.routes = routes\n\n      this.routerOptions = routerOptions\n    }\n  }\n}\n\nexport class ZAdminRouter extends ZAppRouter {\n  genComp (usr: RouteComponent | boolean | undefined, def: RouteComponent): RouteComponent | undefined {\n    if (typeof usr === 'boolean') {\n      return usr ? def : undefined\n    }\n    return usr || def\n  }\n\n  get defaultHome () {\n    return Vue.extend({\n      name: 'z-admin-default-home',\n      render (h) {\n        return h('div', { staticClass: 'z-admin-default-home' })\n      },\n    })\n  }\n\n  parseUsrRoutes (routes: RouteConfig[], parentPath: string): RouteConfig[] {\n    const list: RouteConfig[] = []\n    routes.forEach(route => {\n      if (route) {\n        route.path = genFullPath(route.path)\n        route.name = route.name || `usr-${route.path.replace(/\\//g, '-')}`\n        list.push(route)\n      }\n    })\n    return list\n  }\n\n  setting (options: CreateAdminRouterOptions) {\n    const NotFoundElement = this.genComp(options.appNotFound, ZView404)\n    const NotFoundRoute = { path: '*', component: NotFoundElement }\n    const routeLogin: RouteConfig = { name: 'r__login', path: '/login', component: this.genComp(options.appLogin, ZDefaultLogin) }\n    const route500: RouteConfig = { name: 'r__500', path: '/500', component: this.genComp(options.appServerError, ZView500) }\n    const route403: RouteConfig = { name: 'r__403', path: '/403', component: this.genComp(options.appNotAccess, ZView403) }\n    const route404: RouteConfig = { name: 'r__404', path: '/404', component: NotFoundElement }\n\n    const routeRoot404: RouteConfig = { name: 'r__root_404', path: '*', component: NotFoundElement }\n    const routeRoot: RouteConfig = { name: 'r__root', path: '/', component: options.appMain || ZAdmin }\n    let routeHome: RouteConfig = { name: 'r__home', path: '/', component: options.appHome || this.defaultHome }\n\n    let beforeChildren: RouteConfig[] = [routeHome]\n    const middleChildren: RouteConfig[] = []\n    const afterChildren = [NotFoundRoute]\n\n    // 初始化用户自定义重定向路径\n    const routerOptions = options.routerOptions || {}\n    const usrRoutes = routerOptions.routes || []\n    const [usrHome, ...otherHomes] = usrRoutes.filter(i => /^\\/?$/.test(i.path))\n    if (usrHome) {\n      let homeElement = options.appHome || this.defaultHome\n      if ('component' in usrHome && usrHome.component) {\n        homeElement = usrHome.component\n      }\n      routeHome = { name: 'r__home', ...usrHome, path: '/', component: homeElement }\n      beforeChildren = [routeHome, ...otherHomes]\n    }\n\n    const menuRoutes = createRoutesByMenus(options.menus, '')\n\n    middleChildren.push(...this.parseUsrRoutes(usrRoutes, '/'))\n\n    if (options.redirect) {\n      routeHome.redirect = options.redirect\n    }\n\n    routeRoot.children = [...beforeChildren, ...middleChildren, ...menuRoutes, ...afterChildren]\n\n    routerOptions.routes = [\n      routeLogin,\n      route500,\n      route403,\n      route404,\n      routeRoot,\n      routeRoot404,\n    ]\n    this.routerOptions = routerOptions\n  }\n}\n\nexport class ZRouterClass implements ZRouterDescription {\n  get currentRouter (): VueRouter {\n    return ZRouterClass.router\n  }\n\n  get currentRoutePath (): string {\n    return ZRouterClass.router.currentRoute.path\n  }\n\n  getRouter (): VueRouter {\n    return ZRouterClass.router\n  }\n\n  addRoutesByMenus (menus: ZMenuOption[] = []) {\n    const router = this.currentRouter\n    if (router) {\n      const options = ZRouterClass.adminRouter || {}\n      ZRouterClass.menus = menus = menus || []\n\n      const routes: RouteConfig[] = genRoutesByOptions(options)\n      const routerOptions: RouterOptions = options.routerOptions || Object.create(null)\n      routerOptions.routes = routes\n\n      const newRouter = new VueRouter(routerOptions);\n\n      (router as any).matcher = (newRouter as any).matcher\n\n      // 强制刷新当前路由\n      const route = router.currentRoute\n      router.replace({ path: route.path, query: { ...route.query, t: Date.now() + '' } }).then()\n      router.replace({ path: route.path, query: { ...route.query } }).then()\n    }\n  }\n\n  constructor () {\n    if (!instance) {\n      instance = this\n    }\n    return instance\n  }\n\n  static appRouter: ZAppRouter;\n  static adminRouter: ZAdminRouter;\n  static genAppRouter (options: CreateAppRouterOptions): ZAppRouter {\n    const appRouter = new ZAppRouter()\n    appRouter.setting(options)\n    ZRouterClass.appRouter = appRouter\n    return appRouter\n  }\n\n  static genAdminRouter (options: CreateAdminRouterOptions): ZAdminRouter {\n    const adminRouter = new ZAdminRouter()\n    adminRouter.setting(options)\n    ZRouterClass.adminRouter = adminRouter\n    return adminRouter\n  }\n\n  static menus?: ZMenuOption[]\n\n  static router: VueRouter\n\n  static genInstance (): ZRouterClass {\n    if (!instance) {\n      instance = new ZRouterClass()\n    }\n    return instance\n  }\n}\n\nexport const ZRouter = ZRouterClass.genInstance()\n"],"sourceRoot":"","file":"ZRouter.js"}